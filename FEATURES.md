# HookRegForge 功能说明文档

## 项目概述

**HookRegForge** 是一个专为 JavaScript 逆向工程设计的智能 Hook 路径正则表达式生成器。它能够解析复杂的 JavaScript 代码，自动提取函数调用路径，并生成相应的正则表达式，特别适用于混淆代码的分析和 Hook 脚本的编写。

## 核心功能

### 1. JavaScript 代码解析
- **AST 解析**: 基于 Esprima 引擎，准确解析 JavaScript 语法树
- **语法验证**: 实时检查 JavaScript 代码语法正确性
- **混淆代码支持**: 专门优化处理经过混淆的 JavaScript 代码
- **多种输入方式**: 支持手动输入、加载示例、文件上传

### 2. 文件上传功能 ✨ *新增*
- **支持格式**: `.js`, `.txt`, `.json` 文件
- **文件大小限制**: 最大 10MB
- **自动语法检查**: 上传后自动验证 JavaScript 语法
- **错误处理**: 完善的文件类型和大小验证

### 3. 函数路径提取
- **智能识别**: 自动识别函数调用、方法调用、属性访问
- **深度可配置**: 支持 1-10 层的 AST 遍历深度
- **上下文信息**: 提供详细的调用上下文和参数信息
- **路径分类**: 区分函数调用、方法调用、属性访问等不同类型

### 4. 正则表达式生成
- **精确匹配**: 生成精准的正则表达式模式
- **弹性匹配**: 支持混淆代码的变体匹配
- **模式优化**: 自动优化正则表达式性能
- **详细解释**: 提供正则表达式的详细说明文档

### 5. 测试验证工具
- **实时测试**: 内置正则表达式测试功能
- **匹配高亮**: 显示匹配结果和位置信息
- **捕获组展示**: 显示正则表达式捕获组内容
- **错误诊断**: 提供详细的匹配失败原因

### 6. 用户界面功能
- **现代化设计**: 深色主题，响应式布局
- **标签页导航**: AST 结构、函数路径、正则表达式、测试验证四个模块
- **实时反馈**: 操作成功/失败的即时消息提示
- **语法高亮**: 代码和正则表达式的语法高亮显示

## 使用场景

### 1. 逆向工程
- **Frida Hook**: 为 Frida 脚本生成精确的 Hook 正则
- **代理工具**: 配合 Charles、Burp Suite 等工具进行 API 拦截
- **混淆分析**: 快速定位混淆代码中的关键函数

### 2. 安全研究
- **代码审计**: 快速定位可疑的函数调用模式
- **漏洞挖掘**: 追踪敏感函数的调用链路
- **恶意代码分析**: 分析恶意脚本的执行路径

### 3. 开发调试
- **性能分析**: 定位性能瓶颈函数
- **依赖分析**: 理解代码模块间的依赖关系
- **重构辅助**: 安全地重构复杂的 JavaScript 代码

## 配置选项说明

### 基本配置
- **目标函数名**: 指定要匹配的特定函数名称（可选）
- **Hook 类型**: 
  - 函数调用 - 匹配函数调用表达式
  - 属性访问 - 匹配对象属性访问
  - 方法调用 - 匹配对象方法调用
  - 全部路径 - 匹配所有类型的访问
- **搜索深度**: AST 遍历的最大深度（1-10 层）
- **弹性匹配**: 启用后支持混淆代码的变体匹配

### 弹性匹配特性
当启用弹性匹配时，生成的正则表达式可以匹配以下变体：
```javascript
// 原始代码
obj.method.call()

// 混淆后的变体
obj["method"]["call"]()
obj[a][b]()
_0x1234.method.call()
window["obj"]["method"]["call"]()
```

## 技术架构

### 前端技术栈
- **HTML5**: 语义化标记，无障碍访问
- **CSS3**: 现代样式，Grid 布局，CSS 变量
- **ES6+ JavaScript**: 模块化架构，现代语法特性
- **Esprima**: JavaScript AST 解析引擎
- **Prism.js**: 代码语法高亮库

### 模块结构
```
js/
├── core/                 # 核心业务逻辑
│   ├── config.js        # 应用配置和常量
│   ├── parser.js        # AST 解析器
│   └── regex-generator.js # 正则表达式生成器
├── ui/                   # 用户界面层
│   └── ui-manager.js    # UI 管理和事件处理
├── utils/                # 工具函数库
│   └── helpers.js       # 通用工具函数
└── app.js               # 主应用入口
```

## 已知问题和解决方案

### 1. 按钮无响应问题 ✅ *已修复*
**问题**: 某些情况下按钮点击没有响应
**解决方案**: 
- 增加了详细的元素选择调试信息
- 优化了事件绑定逻辑
- 添加了错误日志输出

### 2. 文件上传功能缺失 ✅ *已实现*
**问题**: 用户期望的文件上传功能未实现
**解决方案**:
- 新增文件上传按钮和处理逻辑
- 支持 .js, .txt, .json 文件格式
- 添加文件大小和类型验证
- 实现文件内容读取和语法检查

### 3. 用户反馈不足 ✅ *已改进*
**问题**: 操作缺少明确的成功/失败反馈
**解决方案**:
- 增加了详细的消息提示系统
- 添加了操作成功的确认消息
- 改进了错误信息的描述

## 使用指南

### 基本使用流程
1. **输入代码**: 手动输入、加载示例或上传文件
2. **配置参数**: 设置目标函数、Hook 类型、搜索深度等
3. **生成分析**: 点击"生成Hook正则"开始解析
4. **查看结果**: 在不同标签页查看 AST、路径、正则表达式
5. **测试验证**: 使用测试功能验证正则表达式效果

### 示例代码
工具内置了复杂的示例代码，包含：
- 嵌套对象结构
- 函数定义和调用
- 动态属性访问
- 多种调用模式

### 最佳实践
1. **从简单开始**: 先用简单代码测试功能
2. **逐步调整**: 根据需要调整搜索深度和匹配类型
3. **验证结果**: 始终使用测试功能验证生成的正则表达式
4. **保存结果**: 及时复制和保存生成的正则表达式

## 浏览器兼容性
- Chrome 60+
- Firefox 60+
- Safari 12+
- Edge 79+

*注意: 需要支持 ES6 模块和现代 JavaScript 特性*

## 开源协议
MIT License - 欢迎贡献和改进

---

**版本**: v1.0.0  
**最后更新**: 2024年12月  
**维护状态**: 积极维护中
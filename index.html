<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HookRegForge - JavaScript Hookè·¯å¾„æ­£åˆ™ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1 class="title">
                    <i class="fas fa-code-branch"></i>
                    HookRegForge
                </h1>
                <p class="subtitle">é¢å‘æ··æ·† JavaScript çš„ Hook è·¯å¾„æ­£åˆ™ç”Ÿæˆå™¨</p>
                <p class="description">è‡ªåŠ¨è§£æ ASTï¼Œæ„é€ å¼¹æ€§æ­£åˆ™ï¼Œç²¾å‡†è¿½è¸ªå‡½æ•°é“¾è°ƒç”¨ï¼ŒåŠ©ä½ æ”»åšé€†å‘ç¬¬ä¸€çº¿</p>
            </div>
        </header>

        <main class="main">
            <div class="workspace">
                <section class="input-section">
                    <div class="section-header">
                        <h2><i class="fas fa-edit"></i> JavaScript ä»£ç è¾“å…¥</h2>
                        <div class="toolbar">
                            <button data-action="clear" class="btn btn-secondary">
                                <i class="fas fa-trash"></i> æ¸…ç©º
                            </button>
                            <button data-action="load-sample" class="btn btn-secondary">
                                <i class="fas fa-file-code"></i> åŠ è½½ç¤ºä¾‹
                            </button>
                            <label data-action="upload-file" class="btn btn-secondary file-upload-btn">
                                <i class="fas fa-upload"></i> ä¸Šä¼ æ–‡ä»¶
                                <input type="file" data-field="file-input" accept=".js,.txt,.json" style="display: none;">
                            </label>
                        </div>
                    </div>
                    <div class="editor-container">
                        <textarea data-field="js-input" class="code-input"></textarea>
                    </div>
                </section>

                <section class="control-section">
                    <div class="section-header">
                        <h2><i class="fas fa-cogs"></i> ç”Ÿæˆé…ç½®</h2>
                    </div>
                    <form class="config-form">
                        <div class="config-group">
                            <label for="target-function">ç›®æ ‡å‡½æ•°å</label>
                            <input type="text" id="target-function" data-field="target-function" class="config-input">
                        </div>
                        <div class="config-group">
                            <label for="hook-type">Hookç±»å‹</label>
                            <select id="hook-type" data-field="hook-type" class="config-select">
                                <option value="function">å‡½æ•°è°ƒç”¨</option>
                                <option value="property">å±æ€§è®¿é—®</option>
                                <option value="method">æ–¹æ³•è°ƒç”¨</option>
                                <option value="all">å…¨éƒ¨è·¯å¾„</option>
                            </select>
                        </div>
                        <div class="config-group">
                            <label for="depth">æœç´¢æ·±åº¦</label>
                            <input type="number" id="depth" data-field="depth" min="1" max="10" value="3" class="config-input">
                        </div>
                        <div class="config-group">
                            <label class="checkbox-label">
                                <input type="checkbox" data-field="flexible" class="config-checkbox">
                                <span class="checkmark"></span>
                                å¼¹æ€§åŒ¹é…
                            </label>
                        </div>
                        <button type="button" data-action="generate" class="btn btn-primary generate-btn">
                            <i class="fas fa-magic"></i> ç”ŸæˆHookæ­£åˆ™
                        </button>
                    </form>
                </section>
            </div>

            <section class="results-section">
                <nav class="tabs" role="tablist">
                    <button class="tab-btn active" data-tab="ast" role="tab" aria-selected="true">
                        <i class="fas fa-sitemap"></i> AST ç»“æ„
                    </button>
                    <button class="tab-btn" data-tab="paths" role="tab" aria-selected="false">
                        <i class="fas fa-route"></i> å‡½æ•°è·¯å¾„
                    </button>
                    <button class="tab-btn" data-tab="regex" role="tab" aria-selected="false">
                        <i class="fas fa-search"></i> æ­£åˆ™è¡¨è¾¾å¼
                    </button>
                    <button class="tab-btn" data-tab="test" role="tab" aria-selected="false">
                        <i class="fas fa-vial"></i> æµ‹è¯•éªŒè¯
                    </button>
                </nav>

                <div class="tab-content">
                    <div data-tab-panel="ast" class="tab-pane active" role="tabpanel">
                        <div class="section-header">
                            <h3>AST è¯­æ³•æ ‘</h3>
                            <button data-action="expand-ast" class="btn btn-small">
                                <i class="fas fa-expand"></i> å±•å¼€æ‰€æœ‰
                            </button>
                        </div>
                        <div class="ast-container">
                            <pre data-output="ast" class="code-output"><code>è§£æçš„ASTç»“æ„å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</code></pre>
                        </div>
                    </div>

                    <div data-tab-panel="paths" class="tab-pane" role="tabpanel">
                        <div class="section-header">
                            <h3>å‘ç°çš„å‡½æ•°è·¯å¾„</h3>
                            <span data-counter="paths" class="badge">0 ä¸ªè·¯å¾„</span>
                        </div>
                        <div class="paths-container">
                            <div data-list="paths" class="paths-list">
                                <div class="empty-state">
                                    <i class="fas fa-search"></i>
                                    <p>è¾“å…¥ä»£ç å¹¶ç‚¹å‡»"ç”ŸæˆHookæ­£åˆ™"æ¥å‘ç°å‡½æ•°è·¯å¾„</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div data-tab-panel="regex" class="tab-pane" role="tabpanel">
                        <div class="section-header">
                            <h3>ç”Ÿæˆçš„æ­£åˆ™è¡¨è¾¾å¼</h3>
                            <button data-action="copy-regex" class="btn btn-small">
                                <i class="fas fa-copy"></i> å¤åˆ¶
                            </button>
                        </div>
                        <div class="regex-container">
                            <div class="regex-output">
                                <pre data-output="regex" class="code-output"><code>ç”Ÿæˆçš„æ­£åˆ™è¡¨è¾¾å¼å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</code></pre>
                            </div>
                            <div class="regex-explanation">
                                <h4>æ­£åˆ™è¯´æ˜</h4>
                                <div data-output="regex-explanation">
                                    <p>æ­£åˆ™è¡¨è¾¾å¼çš„è¯¦ç»†è§£é‡Šå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div data-tab-panel="test" class="tab-pane" role="tabpanel">
                        <div class="section-header">
                            <h3>æµ‹è¯•éªŒè¯</h3>
                        </div>
                        <div class="test-container">
                            <div class="test-input-group">
                                <label for="test-string">æµ‹è¯•å­—ç¬¦ä¸²</label>
                                <textarea id="test-string" data-field="test-string" class="test-input"></textarea>
                            </div>
                            <button data-action="test" class="btn btn-primary">
                                <i class="fas fa-play"></i> è¿è¡Œæµ‹è¯•
                            </button>
                            <div class="test-results">
                                <div data-output="test" class="test-output">
                                    <div class="empty-state">
                                        <i class="fas fa-flask"></i>
                                        <p>è¾“å…¥æµ‹è¯•å­—ç¬¦ä¸²å¹¶è¿è¡Œæµ‹è¯•</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>å…³äº HookRegForge</h4>
                    <p>ä¸“ä¸ºJavaScripté€†å‘å·¥ç¨‹å¸ˆè®¾è®¡çš„æ™ºèƒ½Hookè·¯å¾„ç”Ÿæˆå·¥å…·</p>
                </div>
                <div class="footer-section">
                    <h4>åŠŸèƒ½ç‰¹æ€§</h4>
                    <ul>
                        <li>æ™ºèƒ½ASTè§£æ</li>
                        <li>å¼¹æ€§æ­£åˆ™ç”Ÿæˆ</li>
                        <li>è·¯å¾„è¿½è¸ªä¼˜åŒ–</li>
                        <li>æ··æ·†ä»£ç æ”¯æŒ</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>å¼€æºé¡¹ç›®</h4>
                    <p>
                        <a href="https://github.com/D-Dl1/HookRegForge" target="_blank" rel="noopener noreferrer">
                            <i class="fab fa-github"></i> GitHub
                        </a>
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <div data-overlay="loading" class="loading">
        <div class="spinner"></div>
        <p>æ­£åœ¨ç”ŸæˆHookæ­£åˆ™...</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    
    <!-- Esprima å¤šCDNåŠ è½½ç­–ç•¥ -->
    <script>
        // CDNåŠ è½½ç­–ç•¥ï¼šå°è¯•å¤šä¸ªCDNæº
        const esprimaCDNs = [
            'https://cdnjs.cloudflare.com/ajax/libs/esprima/4.0.1/esprima.min.js',
            'https://unpkg.com/esprima@4.0.1/dist/esprima.min.js',
            'https://cdn.jsdelivr.net/npm/esprima@4.0.1/dist/esprima.min.js',
            'https://cdn.skypack.dev/esprima@4.0.1'
        ];
        
        let esprimaLoaded = false;
        let currentCDNIndex = 0;
        
        function loadEsprimaFromCDN(url, callback) {
            const script = document.createElement('script');
            script.src = url;
            script.onload = function() {
                console.log('âœ… Esprima loaded from:', url);
                esprimaLoaded = true;
                if (callback) callback(true);
            };
            script.onerror = function() {
                console.warn('âŒ Failed to load Esprima from:', url);
                if (callback) callback(false);
            };
            document.head.appendChild(script);
        }
        
        function tryNextCDN() {
            if (currentCDNIndex < esprimaCDNs.length) {
                const url = esprimaCDNs[currentCDNIndex];
                console.log(`ğŸ”„ Trying CDN ${currentCDNIndex + 1}/${esprimaCDNs.length}:`, url);
                
                loadEsprimaFromCDN(url, function(success) {
                    if (success) {
                        esprimaLoaded = true;
                    } else {
                        currentCDNIndex++;
                        if (currentCDNIndex < esprimaCDNs.length) {
                            setTimeout(tryNextCDN, 1000); // ç­‰å¾…1ç§’åå°è¯•ä¸‹ä¸€ä¸ªCDN
                        } else {
                            console.error('âŒ All CDN sources failed, loading local fallback...');
                            loadLocalEsprima();
                        }
                    }
                });
            }
        }
        
        function loadLocalEsprima() {
            // å°è¯•åŠ è½½æœ¬åœ°ç‰ˆæœ¬
            loadEsprimaFromCDN('js/lib/esprima.min.js', function(success) {
                if (!success) {
                    console.error('âŒ Local Esprima also failed to load');
                    showEsprimaLoadError();
                }
            });
        }
        
        function showEsprimaLoadError() {
            const errorDiv = document.createElement('div');
            errorDiv.innerHTML = `
                <div style="
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #1a1f25;
                    color: #e6e6e6;
                    padding: 2rem;
                    border-radius: 12px;
                    border: 1px solid #3c4043;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
                    z-index: 10000;
                    text-align: center;
                    max-width: 500px;
                    font-family: 'Inter', sans-serif;
                ">
                    <div style="color: #e06c75; font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
                    <h3 style="margin-bottom: 1rem; color: #e6e6e6;">ä¾èµ–åº“åŠ è½½å¤±è´¥</h3>
                    <p style="margin-bottom: 1rem; line-height: 1.5;">
                        Esprimaåº“æœªèƒ½ä»ä»»ä½•CDNæºåŠ è½½æˆåŠŸã€‚è¿™å¯èƒ½æ˜¯ç”±äºï¼š<br>
                        â€¢ ç½‘ç»œè¿æ¥é—®é¢˜<br>
                        â€¢ CDNæœåŠ¡æš‚æ—¶ä¸å¯ç”¨<br>
                        â€¢ é˜²ç«å¢™æˆ–ä»£ç†é˜»æ­¢äº†è¯·æ±‚
                    </p>
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button onclick="location.reload()" style="
                            background: #61dafb;
                            color: #0f1419;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 500;
                        ">é‡æ–°åŠ è½½</button>
                        <button onclick="window.open('cdn-status.html', '_blank')" style="
                            background: #98c379;
                            color: #0f1419;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 500;
                        ">æ£€æŸ¥CDNçŠ¶æ€</button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            background: transparent;
                            color: #abb2bf;
                            border: 1px solid #3c4043;
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            cursor: pointer;
                        ">å…³é—­</button>
                    </div>
                    <p style="margin-top: 1rem; font-size: 0.9rem; color: #6c7086;">
                        å»ºè®®ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥åé‡æ–°åŠ è½½é¡µé¢
                    </p>
                </div>
            `;
            document.body.appendChild(errorDiv);
        }
        
        // å¼€å§‹åŠ è½½Esprima
        tryNextCDN();
    </script>
    
    <script src="js/fallback-events.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
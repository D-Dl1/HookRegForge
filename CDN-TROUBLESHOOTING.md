# CDN 加载问题解决指南

## 问题描述
如果你在使用 HookRegForge 时遇到 "Esprima库未能正确加载" 的错误，这通常是由于 CDN 网络问题导致的。

## 解决方案

### 1. 自动重试机制
应用现在内置了多CDN自动重试机制，会依次尝试以下CDN源：

- **Cloudflare CDN** - `https://cdnjs.cloudflare.com/`
- **unpkg CDN** - `https://unpkg.com/`
- **jsDelivr CDN** - `https://cdn.jsdelivr.net/`
- **Skypack CDN** - `https://cdn.skypack.dev/`

### 2. CDN状态检查工具
如果遇到加载问题，可以使用内置的 CDN 状态检查工具：

1. 点击错误提示中的 "检查CDN状态" 按钮
2. 或直接访问 `cdn-status.html` 页面
3. 工具会自动测试所有CDN源并提供诊断信息

### 3. 本地备用方案
如果所有CDN都无法访问，应用会自动加载本地备用解析器：

- 位置：`js/lib/esprima.min.js`
- 功能：提供基础的JavaScript语法验证
- 限制：某些高级AST解析功能可能不可用

### 4. 手动解决步骤

#### 方法一：刷新页面
最简单的解决方案是刷新页面，让系统重新尝试加载：
```
Ctrl+F5 (Windows/Linux) 或 Cmd+Shift+R (Mac)
```

#### 方法二：检查网络连接
1. 确保网络连接正常
2. 尝试访问其他网站确认网络状态
3. 如果使用代理或VPN，尝试关闭后重试

#### 方法三：清除缓存
1. 清除浏览器缓存
2. 禁用浏览器扩展（如广告拦截器）
3. 尝试使用隐私模式/无痕模式

#### 方法四：使用不同的CDN
如果特定CDN被阻止，应用会自动尝试其他源。你也可以：

1. 打开浏览器开发者工具（F12）
2. 查看控制台日志了解具体的加载情况
3. 网络面板可以显示哪些请求失败了

### 5. 网络环境特殊情况

#### 企业网络/防火墙
如果在企业网络环境中：
- 联系IT管理员将CDN域名加入白名单
- 或请求临时放开JavaScript CDN访问

#### 地区网络限制
某些地区可能限制访问国外CDN：
- 尝试使用VPN
- 使用本地网络环境测试
- 考虑部署到本地服务器

### 6. 开发者选项

#### 本地部署
如果经常遇到CDN问题，可以考虑本地部署：

1. 下载完整的Esprima库文件
2. 放置到 `js/lib/` 目录
3. 修改HTML文件直接引用本地文件

#### 自定义CDN
可以修改 `index.html` 中的CDN列表，添加你信任的CDN源。

## 技术细节

### 加载策略
```javascript
// 应用使用以下策略加载Esprima：
1. 尝试主CDN (Cloudflare)
2. 失败后等待1秒，尝试下一个CDN
3. 重复直到所有CDN都尝试过
4. 最后尝试本地备用文件
5. 如果都失败，显示错误提示
```

### 超时设置
- 每个CDN尝试超时：10秒
- 总初始化尝试：15次，每次间隔500ms
- 这给了CDN充分的加载时间

### 错误日志
所有加载尝试都会在浏览器控制台中记录，便于调试：
- ✅ 成功加载
- ❌ 加载失败
- ⚠️ 使用备用解析器

## 联系支持
如果以上方案都无法解决问题，请：

1. 打开浏览器开发者工具，截图控制台错误信息
2. 运行CDN状态检查工具，记录结果
3. 提供你的网络环境信息（地区、ISP等）
4. 在GitHub项目中提交Issue

## 更新日志
- **v2.1** - 添加多CDN自动重试机制
- **v2.2** - 增加本地备用解析器
- **v2.3** - 添加CDN状态检查工具
- **v2.4** - 改进错误提示和用户体验
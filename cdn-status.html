<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDNçŠ¶æ€æ£€æŸ¥ - HookRegForge</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f1419;
            color: #e6e6e6;
            padding: 2rem;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .status-card {
            background: #1a1f25;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 1px solid #3c4043;
        }
        .status-loading {
            color: #e5c07b;
        }
        .status-success {
            color: #98c379;
        }
        .status-error {
            color: #e06c75;
        }
        .btn {
            background: #61dafb;
            color: #0f1419;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        .btn:hover {
            background: #4fa8c5;
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #3c4043;
            border-radius: 3px;
            overflow: hidden;
            margin: 1rem 0;
        }
        .progress-fill {
            height: 100%;
            background: #61dafb;
            width: 0%;
            transition: width 0.3s ease;
        }
        pre {
            background: #282c34;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” CDNçŠ¶æ€æ£€æŸ¥</h1>
        <p>æ£€æŸ¥å„ä¸ªCDNæºçš„Esprimaåº“åŠ è½½çŠ¶æ€</p>
        
        <div class="status-card">
            <h2>æµ‹è¯•è¿›åº¦</h2>
            <div class="progress-bar">
                <div id="progress" class="progress-fill"></div>
            </div>
            <div id="status">å‡†å¤‡å¼€å§‹æµ‹è¯•...</div>
        </div>
        
        <div class="status-card">
            <h2>CDNæºæµ‹è¯•ç»“æœ</h2>
            <div id="results"></div>
        </div>
        
        <div class="status-card">
            <h2>æ¨èè§£å†³æ–¹æ¡ˆ</h2>
            <div id="recommendations">
                <p>æ­£åœ¨åˆ†ææœ€ä½³CDNæº...</p>
            </div>
        </div>
        
        <div class="status-card">
            <h2>æ“ä½œ</h2>
            <button class="btn" onclick="startTest()">é‡æ–°æµ‹è¯•</button>
            <button class="btn" onclick="goToApp()">è¿”å›åº”ç”¨</button>
            <button class="btn" onclick="showDiagnostics()">æ˜¾ç¤ºè¯Šæ–­ä¿¡æ¯</button>
        </div>
        
        <div id="diagnostics" class="status-card" style="display: none;">
            <h2>è¯Šæ–­ä¿¡æ¯</h2>
            <pre id="diagnostic-info"></pre>
        </div>
    </div>

    <script>
        const cdnSources = [
            {
                name: 'Cloudflare CDN',
                url: 'https://cdnjs.cloudflare.com/ajax/libs/esprima/4.0.1/esprima.min.js',
                description: 'å…¨çƒæœ€å¤§çš„CDNç½‘ç»œä¹‹ä¸€'
            },
            {
                name: 'unpkg CDN',
                url: 'https://unpkg.com/esprima@4.0.1/dist/esprima.min.js',
                description: 'npmåŒ…çš„å¿«é€ŸCDN'
            },
            {
                name: 'jsDelivr CDN',
                url: 'https://cdn.jsdelivr.net/npm/esprima@4.0.1/dist/esprima.min.js',
                description: 'å¼€æºCDNï¼Œæ”¯æŒnpmå’ŒGitHub'
            },
            {
                name: 'Skypack CDN',
                url: 'https://cdn.skypack.dev/esprima@4.0.1',
                description: 'ç°ä»£ESæ¨¡å—CDN'
            }
        ];
        
        let testResults = [];
        let currentTest = 0;
        
        function updateProgress() {
            const progress = document.getElementById('progress');
            const percentage = (currentTest / cdnSources.length) * 100;
            progress.style.width = percentage + '%';
        }
        
        function updateStatus(message, className = '') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = className;
        }
        
        function addResult(source, success, error = null, responseTime = null) {
            testResults.push({ source, success, error, responseTime });
            
            const results = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.style.cssText = 'margin: 0.5rem 0; padding: 0.5rem; border-radius: 6px; background: rgba(255,255,255,0.05);';
            
            const statusIcon = success ? 'âœ…' : 'âŒ';
            const statusClass = success ? 'status-success' : 'status-error';
            const timeInfo = responseTime ? ` (${responseTime}ms)` : '';
            
            resultDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong class="${statusClass}">${statusIcon} ${source.name}</strong>
                        <div style="font-size: 0.9rem; color: #abb2bf; margin-top: 0.2rem;">
                            ${source.description}
                        </div>
                    </div>
                    <div class="${statusClass}" style="font-size: 0.9rem;">
                        ${success ? 'å¯ç”¨' + timeInfo : 'å¤±è´¥'}
                    </div>
                </div>
                ${error ? `<div style="font-size: 0.8rem; color: #e06c75; margin-top: 0.5rem;">é”™è¯¯: ${error}</div>` : ''}
            `;
            
            results.appendChild(resultDiv);
        }
        
        function testCDN(source) {
            return new Promise((resolve) => {
                const startTime = Date.now();
                const script = document.createElement('script');
                const timeout = setTimeout(() => {
                    resolve({ success: false, error: 'è¶…æ—¶', responseTime: null });
                }, 10000);
                
                script.onload = function() {
                    clearTimeout(timeout);
                    const responseTime = Date.now() - startTime;
                    script.remove();
                    resolve({ success: true, error: null, responseTime });
                };
                
                script.onerror = function() {
                    clearTimeout(timeout);
                    script.remove();
                    resolve({ success: false, error: 'ç½‘ç»œé”™è¯¯', responseTime: null });
                };
                
                script.src = source.url;
                document.head.appendChild(script);
            });
        }
        
        async function startTest() {
            testResults = [];
            currentTest = 0;
            document.getElementById('results').innerHTML = '';
            document.getElementById('recommendations').innerHTML = '<p>æ­£åœ¨åˆ†ææœ€ä½³CDNæº...</p>';
            
            updateStatus('å¼€å§‹æµ‹è¯•CDNæº...', 'status-loading');
            
            for (const source of cdnSources) {
                updateStatus(`æ­£åœ¨æµ‹è¯• ${source.name}...`, 'status-loading');
                
                const result = await testCDN(source);
                addResult(source, result.success, result.error, result.responseTime);
                
                currentTest++;
                updateProgress();
            }
            
            updateStatus('æµ‹è¯•å®Œæˆ', 'status-success');
            generateRecommendations();
        }
        
        function generateRecommendations() {
            const recommendations = document.getElementById('recommendations');
            const successfulSources = testResults.filter(r => r.success);
            
            if (successfulSources.length === 0) {
                recommendations.innerHTML = `
                    <div class="status-error">
                        <h3>âŒ æ‰€æœ‰CDNæºå‡ä¸å¯ç”¨</h3>
                        <p>å¯èƒ½çš„åŸå› ï¼š</p>
                        <ul>
                            <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
                            <li>é˜²ç«å¢™æˆ–ä»£ç†é˜»æ­¢äº†è¯·æ±‚</li>
                            <li>æ‰€åœ¨åœ°åŒºçš„ç½‘ç»œé™åˆ¶</li>
                        </ul>
                        <p><strong>å»ºè®®ï¼š</strong></p>
                        <ul>
                            <li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
                            <li>å°è¯•ä½¿ç”¨VPN</li>
                            <li>è”ç³»ç½‘ç»œç®¡ç†å‘˜</li>
                            <li>ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬çš„åº“æ–‡ä»¶</li>
                        </ul>
                    </div>
                `;
            } else {
                // æŒ‰å“åº”æ—¶é—´æ’åº
                successfulSources.sort((a, b) => a.responseTime - b.responseTime);
                const fastest = successfulSources[0];
                
                recommendations.innerHTML = `
                    <div class="status-success">
                        <h3>âœ… æ‰¾åˆ°å¯ç”¨çš„CDNæº</h3>
                        <p><strong>æ¨èä½¿ç”¨ï¼š</strong> ${fastest.source.name} (${fastest.responseTime}ms)</p>
                        <p>å¯ç”¨æºåˆ—è¡¨ï¼š</p>
                        <ul>
                            ${successfulSources.map(r => 
                                `<li>${r.source.name} - ${r.responseTime}ms</li>`
                            ).join('')}
                        </ul>
                        <p>åº”ç”¨å°†è‡ªåŠ¨é€‰æ‹©æœ€å¿«çš„å¯ç”¨æºã€‚</p>
                    </div>
                `;
            }
        }
        
        function goToApp() {
            window.location.href = 'index.html';
        }
        
        function showDiagnostics() {
            const diagnostics = document.getElementById('diagnostics');
            const info = document.getElementById('diagnostic-info');
            
            const diagnosticData = {
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                timestamp: new Date().toISOString(),
                testResults: testResults,
                location: {
                    href: window.location.href,
                    origin: window.location.origin
                }
            };
            
            info.textContent = JSON.stringify(diagnosticData, null, 2);
            diagnostics.style.display = 'block';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æµ‹è¯•
        window.addEventListener('load', startTest);
    </script>
</body>
</html>